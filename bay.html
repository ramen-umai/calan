<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>購入ページ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    .navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='%23FFDA1A' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
</style>
<body>
    <nav class="navbar sticky-top navbar-expand-lg px-4"
     style="background-color:#000000;">

    <div class="container-fluid">

        <!-- ブランド -->
        <a class="navbar-brand fw-bold fs-4"
           href="index.html"
           style="color:#FFDA1A;">
            Calan
        </a>

        <!-- ハンバーガー -->
        <button class="navbar-toggler border-0"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- メニュー -->
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link"
                       style="color:#96c7ff;"
                       href="index.html">
                       HOME
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       style="color: #96c7ff;"
                       href="market.html">
                       MARKET
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link"
                       style="color: #96c7ff;"
                       href="about.html">
                       ABOUT
                    </a>
                </li>
            </ul>
        </div>

    </div>
</nav>

<div class="container mt-5">
  <div id="productArea"></div>
</div>

<!-- 先にmain.jsを読み込む -->
<script src="main.js"></script>

<script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    
    const product = Object.values(datalist).find(item => item.id === id);
    const area = document.getElementById("productArea");
    
    if (!product) {
        area.innerHTML = `<div class="alert alert-danger">商品が見つかりません。</div>`;
    } else {
    
        area.innerHTML = `
            <div class="card shadow">
                <div class="card-body">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
    
                    <div class="mb-3">
                        <label class="form-label">通貨</label>
                        <select class="form-select" id="currencySelect">
                            <option value="jpy">JPY</option>
                            <option value="cvd">CVD</option>
                            <option value="kira">KIRA</option>
                            <option value="ki">KI</option>
                        </select>
                    </div>
    
                    <div class="mb-3">
                        <label class="form-label">数量</label>
                        <input type="number" class="form-control" id="quantityInput" value="1" min="1">
                    </div>
    
                    <h4 id="priceArea">JPY: ${product.money.jpy}</h4>
    
                    <button class="btn btn-success mt-3" id="purchaseBtn">
                        注文する
                    </button>
    
                    <div id="resultArea" class="mt-3"></div>
                </div>
            </div>
        `;
    
        const select = document.getElementById("currencySelect");
        const quantityInput = document.getElementById("quantityInput");
        const priceArea = document.getElementById("priceArea");
        const resultArea = document.getElementById("resultArea");
    
        function updatePrice() {
            const currency = select.value;
            const quantity = Number(quantityInput.value) || 1;
            const total = product.money[currency] * quantity;
            priceArea.textContent = `${currency.toUpperCase()}: ${total}`;
        }
    
        select.addEventListener("change", updatePrice);
        quantityInput.addEventListener("input", updatePrice);
    
        document.getElementById("purchaseBtn").addEventListener("click", () => {
    
            const currency = select.value;
            const quantity = Number(quantityInput.value) || 1;
            const total = product.money[currency] * quantity;
    
            const url = "https://docs.google.com/forms/d/e/1FAIpQLScUn3UiErTU34mz8F8GMP73itp3Y5bFm2U3nLq6eSrnjcb9Eg/formResponse";
    
            const formData = new FormData();
            formData.append("entry.514204796", product.id);
            formData.append("entry.496564451", product.name);
            formData.append("entry.2111411790", currency.toUpperCase());
            formData.append("entry.1758852127", total);
            formData.append("entry.2147439510", quantity);
    
            fetch(url, {
                method: "POST",
                mode: "no-cors",
                body: formData
            }).then(() => {
                resultArea.innerHTML = `
                    <div class="alert alert-success">
                        注文が送信されました。ありがとうございました。
                    </div>
                `;
            });
        });
    }
    </script>

</body>
</html>
